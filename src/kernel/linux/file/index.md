---
title: 文件管理
order: 40
---

# 文件管理
文件管理是操作系统进行持久化管理的整一套链路。包括从对底层磁盘等外部存储设备的管理，到对于提供给上层用户的文件接口。在用户打开了一个文件，并写入数据的过程中，涉及了多个子系统的配合。

其中包括：
+ 应用层-进程管理子系统
+ 系统调用层-系统调用子系统
+ vfs 层-虚拟文件子系统
+ 协议层-块设备子系统、网络子系统
+ 设备层-设备管理子系统
  + 设备抽象层
  + 设备驱动层
  + 物理硬件层

## 应用层
在应用层，用户态程序以进程为单位来维护进程本身所使用的资源。用户程序需要使用一个文件的时候，会先向

## 系统调用

## VFS
Linux 继承了 Unix 系统的经典哲学——**一切皆文件**的思想。虚拟文件系统（Virtual File System，VFS）是 Linux 内核中的一个重要抽象层，它为不同的文件系统提供了统一的接口，使得应用程序可以用相同的方式访问不同类型的文件系统。

注意区分虚拟文件系统和文件系统，虚拟文件系统是 Linux 的管理文件的子系统，而文件系统是一种通用的协议。

## 协议层

### 文件系统
文件系统是一种协议，规定了如何在磁盘上组织和存储数据。因为，磁盘是块设备，可以看作是一个具有固定大小的字节数组。而我们打开一个磁盘看到的却是一个树形的文件目录结构，如何在一个字节数组上去存储一个树形的文件目录结构，就是文件系统干的事情。

- 文件系统是跨操作系统的，一个操作系统只要能够实现一个文件系统就可以，从一个使用某种文件系统组织数据的磁盘中获取数据
- 同一个系统管理的不同的磁盘也可以使用不同文件系统来管理
- 文件系统与磁盘驱动之间没有直接关联，文件系统描述的是字节数据的组织形式，而磁盘驱动负责从磁盘读写字节数据块；但是文件系统往往需要间接调用驱动来帮它读写数据，操作硬件。
- 磁盘在挂载到虚拟文件系统前需要格式化，格式化过程就是建立文件系统的过程
 
### 网络协议栈

## 设备层