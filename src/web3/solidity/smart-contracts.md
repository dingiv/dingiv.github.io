---
title: 智能合约
order: 3
---
# 智能合约

## 智能合约基础

智能合约是部署在区块链上自动执行的程序代码，一旦部署不可修改，为DeFi、NFT等应用提供了可信执行环境。合约由函数调用触发执行，状态变更永久记录在区块链上。

## 合约生命周期

智能合约的生命周期包括编写、编译、部署和执行四个阶段。部署后合约获得唯一地址，用户可以通过交易调用合约函数，合约可以自毁但不能被他人修改。

## 合约存储与内存

合约存储分为storage、memory和calldata三种类型，storage数据永久存储在链上且成本高昂，memory和calldata在执行期间临时存在。优化存储使用可以大幅降低Gas消耗。

## 事件与日志

事件是合约记录日志的机制，允许前端应用监听链上活动。事件参数存储在日志中，不占用合约存储空间，索引后的参数可以高效检索。

## 访问控制

通过修饰符（modifier）和onlyOwner模式实现合约的访问控制，确保关键操作只能由授权地址执行。多签钱包通过要求多个私钥授权来分散风险。

## 代理合约模式

代理合约通过将逻辑合约和数据合约分离，实现合约代码的可升级性。用户与代理合约交互，代理合约将调用委托给逻辑合约，从而在保持地址不变的情况下升级功能。

## 合约安全与漏洞

常见合约漏洞包括重入攻击、整数溢出、访问控制失效和前端攻击等。重入攻击通过在以太币到账前再次调用合约函数来提取资金，可通过检查-生效-交互模式（CEI）预防。

## Oracle预言机

预言机将链下数据传输到链上供智能合约使用，是连接区块链与现实世界的重要桥梁。Chainlink等去中心化预言机通过多个数据源聚合保证数据的准确性和防篡改。

## 合约审计与测试

合约审计通过静态分析、人工审查和模糊测试发现潜在漏洞，测试覆盖率直接影响合约安全性。主网部署前的充分测试和专业审计是保障资金安全的关键。
