# 浏览器原理

## 浏览器工作原理

### 浏览器工作流程

1. 用户输入
2. URL解析
3. DNS解析
4. TCP连接
5. 发送HTTP请求
6. 服务器处理请求
7. 返回HTTP响应
8. 浏览器解析HTML
9. 浏览器渲染页面
10. 关闭连接

### 浏览器渲染流程

1. 解析HTML，构建DOM树
2. 解析CSS，构建CSSOM树
3. 合并DOM树和CSSOM树，构建渲染树（Render Tree）
4. 布局（Layout/Reflow）：计算元素位置和大小
5. 绘制（Paint）：将渲染树转换为像素
6. 合成（Composite）：将页面分层，合成显示
7. 事件处理：响应用户交互
8. 更新页面：处理DOM变化、CSS变化、布局变化、绘制变化等
9. 垃圾回收：清理不再使用的内存
10. 关闭连接



## 浏览器缓存

### 浏览器缓存机制

1. 强缓存：浏览器在本地缓存中查找资源，如果找到且未过期，则直接使用缓存资源，否则继续请求服务器。
2. 协商缓存：浏览器在本地缓存中查找资源，如果找到且未过期，则向服务器发送请求，服务器验证资源是否更新，如果更新则返回新资源，否则返回304状态码，浏览器使用本地缓存资源。

### 浏览器缓存策略

1. Cache-Control：控制缓存的策略，如max-age、no-cache、no-store等。
   1. max-age：指定缓存的过期时间，单位为秒。
   2. no-cache：表示每次请求都需要验证缓存是否有效。
   3. no-store：表示不缓存资源。
2. Expires：指定缓存的过期时间，格式为GMT时间。
3. ETag：资源的唯一标识符，用于验证缓存是否有效。
4. Last-Modified：资源的最后修改时间，用于验证缓存是否有效。
5. If-None-Match：客户端发送的ETag值，服务器根据该值判断资源是否更新。
6. If-Modified-Since：客户端发送的Last-Modified值，服务器根据该值判断资源是否更新。
7. Cache-Control优先级高于Expires，ETag优先级高于Last-Modified。
8. 浏览器会根据Cache-Control、Expires、ETag、Last-Modified等字段来判断资源是否有效，如果有效则使用缓存资源，否则向服务器请求新资源。



## 浏览器安全

### 浏览器安全机制

1. 同源策略：限制一个origin（协议+域名+端口）的文档或脚本如何与另一个源的资源进行交互。同源策略可以防止恶意文档，通过恶意脚本窃取数据。
2. 跨站脚本攻击（XSS）：攻击者通过在网页中插入恶意脚本，窃取用户数据或执行恶意操作。
3. 跨站请求伪造（CSRF）：攻击者通过诱导用户点击恶意链接或表单，以用户身份执行恶意操作。
4. 内容安全策略（CSP）：通过设置HTTP头部的Content-Security-Policy，限制网页可以加载和执行的资源，防止XSS攻击。
5. HTTPS：通过加密通信，防止中间人攻击和数据窃取。
6. Cookie安全：通过设置HttpOnly和Secure标志，防止Cookie被JavaScript访问和窃取。
7. 安全沙箱：浏览器为每个标签页或iframe创建一个独立的沙箱环境，限制其访问其他标签页或iframe的资源。
8. 安全更新：定期更新浏览器和插件，修复已知的安全漏洞。
9. 安全测试：定期进行安全测试，发现和修复安全漏洞。



