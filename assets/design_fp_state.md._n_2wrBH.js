import{_ as e,o as t,c as i,ah as r}from"./chunks/framework.CJUjh4G6.js";const _=JSON.parse('{"title":"状态管理","description":"","frontmatter":{},"headers":[],"relativePath":"design/fp/state.md","filePath":"design/fp/state.md"}'),l={name:"design/fp/state.md"};function n(s,a,p,o,d,h){return t(),i("div",null,[...a[0]||(a[0]=[r('<h1 id="状态管理" tabindex="-1">状态管理 <a class="header-anchor" href="#状态管理" aria-label="Permalink to “状态管理”">​</a></h1><p>在函数的世界中，为了能够达到纯洁，我们引入了纯函数，纯函数没有副作用，没有状态的变化，但是纯函数并不能解决所有的问题，比如我们需要在某个时刻记录一些状态，比如用户登录状态，购物车状态等等，这些状态的变化需要被记录下来，但是又不能影响纯函数的执行，所以我们需要引入状态管理。</p><h2 id="状态管理的基本概念" tabindex="-1">状态管理的基本概念 <a class="header-anchor" href="#状态管理的基本概念" aria-label="Permalink to “状态管理的基本概念”">​</a></h2><p>状态管理的基本概念包括：</p><ul><li>状态：程序运行时的数据，包括变量、对象、数组等。</li><li>生命周期：状态具有 4 个生命周期，创建、读取、修改、销毁。</li></ul><p>状态管理的核心思路就是<strong>使用容器维护变量的生命周期</strong>，并向下游提供统一的 API，下游不再直接声明、读取、修改、销毁数据，必须经过状态管理容器的 API 来访问数据。</p><p>对于多数简单的程序都适用，可以使用一个或多个集中的结构体定义整个程序状态，可以根据业务模块拆分成子结构，然后在 main 函数中管理该结构体的唯一实例的生命周期。例如：可以创建一个 Config 和一个 AppState 结构来保存当前的程序的状态，程序的各个功能模块的函数都可以看作是这些结构体的关联方法。</p><h2 id="状态的生命周期" tabindex="-1">状态的生命周期 <a class="header-anchor" href="#状态的生命周期" aria-label="Permalink to “状态的生命周期”">​</a></h2><p>状态的生命周期包括：</p><ul><li>创建：init，创建状态，包括变量的初始化、对象的创建、数组的初始化等。</li><li>读取：get，通过纯函数来访问状态。</li><li>修改：set，通过纯函数来修改状态。</li><li>销毁：drop，销毁状态，包括变量的销毁、对象的销毁、数组的销毁等。</li></ul><p>一个操作对应 2 个切点，共 8 个切点，状态管理容器需要在这 8 个切点中进行拦截，添加额外的逻辑进行处理，从而保证数据的安全。下游的代码只需要考虑<strong>读取状态和修改状态</strong>即可，而不需要考虑创建和释放状态。</p><h2 id="衍生状态" tabindex="-1">衍生状态 <a class="header-anchor" href="#衍生状态" aria-label="Permalink to “衍生状态”">​</a></h2><p>衍生状态是指依赖于其他状态，在其他状态地基础上经过进一步计算得到的状态，当其他状态发生变化时，衍生状态也需要发生变化。衍生状态往往可以通过纯函数来计算，从而简化衍生状态的逻辑。</p><h2 id="状态订阅" tabindex="-1">状态订阅 <a class="header-anchor" href="#状态订阅" aria-label="Permalink to “状态订阅”">​</a></h2><p>状态订阅属于响应式编程的技术，达到自动广播变化的目的，避免由程序员手动同步数据变化。当状态发生变化时，通知相关的副作用函数，使得副作用在用户进行输入的时候发生，而不是我们的程序主动发出的副作用。</p><p>订阅主要是订阅 set 和 drop，因为这两个函数会改变状态，所以需要通知相关的副作用函数和衍生状态重新执行。</p><p>自动订阅和手动订阅，手动订阅需要用户手动调用 API 来指定订阅的数据，而自动订阅通过拦截状态读取时的操作，并且或者当前的关联函数，将被读取的变量和关联的函数自动进行绑定，当变量发生变化的时候，自动触发该管理函数。</p>',17)])])}const f=e(l,[["render",n]]);export{_ as __pageData,f as default};
