import{_ as i,o as a,c as e,ah as r}from"./chunks/framework.BwbIerCg.js";const s=JSON.parse('{"title":"混合渲染管线","description":"","frontmatter":{},"headers":[],"relativePath":"client/render/raytrace/integrate.md","filePath":"client/render/raytrace/integrate.md"}'),t={name:"client/render/raytrace/integrate.md"};function p(n,l,o,u,c,d){return a(),e("div",null,[...l[0]||(l[0]=[r('<h1 id="混合渲染管线" tabindex="-1">混合渲染管线 <a class="header-anchor" href="#混合渲染管线" aria-label="Permalink to “混合渲染管线”">​</a></h1><p>现代游戏引擎普遍采用光栅化 + 光线追踪的混合管线，在性能和质量之间取得平衡。</p><h3 id="反射" tabindex="-1">反射 <a class="header-anchor" href="#反射" aria-label="Permalink to “反射”">​</a></h3><p>光栅化传统的反射方案是屏幕空间反射（SSR），但只能反射屏幕内的物体，且有遮挡和边缘问题。光线追踪反射精确且完整。</p><ul><li><p>实现策略：</p><ul><li>对粗糙度低于阈值的像素，反射方向生成反射光线</li><li>反射光线递归深度通常限制在 1-2 次</li><li>对反射结果应用降噪（时间累积 + 空间滤波）</li></ul></li><li><p>优化技巧：</p><ul><li>降低反射分辨率（如半分辨率），使用双边滤波上采样</li><li>次要反射（反射的反射）使用探针或环境光近似</li><li>对远距离物体使用更低精度的 BVH 或 Impostor</li></ul></li></ul><h3 id="阴影" tabindex="-1">阴影 <a class="header-anchor" href="#阴影" aria-label="Permalink to “阴影”">​</a></h3><p>光栅化的 Shadow Map 只能产生硬阴影，PCF 软化边缘但仍不自然。光线追踪支持面光源的软阴影，半影区域自然过渡。</p><ul><li><p>实现策略：</p><ul><li>对每个可见像素，向光源发射阴影光线</li><li>面光源使用软阴影采样，在光源表面随机采样点</li><li>直接光照使用 1-2 条阴影光线，间接光照使用路径追踪</li></ul></li><li><p>优化技巧：</p><ul><li>级联阴影：近距离使用高分辨率阴影光线，远距离使用低分辨率</li><li>阴影复用：相邻像素共享部分阴影光线</li><li>延迟阴影：先渲染无阴影图像，再单独计算阴影通道叠加</li></ul></li></ul><h3 id="全局光照" tabindex="-1">全局光照 <a class="header-anchor" href="#全局光照" aria-label="Permalink to “全局光照”">​</a></h3><p>全局光照是光线追踪的最大优势，但计算成本极高。实时应用使用近似方法。</p><ul><li><p>屏幕空间全局光照（SSGI）：</p><ul><li>在屏幕空间反射随机光线，估计间接光照</li><li>优点是快速，缺点是只能反射屏幕内的物体</li></ul></li><li><p>有限的路径追踪：</p><ul><li>每像素追踪 1-2 次反射，估计间接光照</li><li>使用时间累积和降噪，数百帧后收敛</li><li>静态场景可以预烘焙，运行时复用</li></ul></li><li><p>光照探针：</p><ul><li>在场景中放置探针，预计算每个探针的全局光照</li><li>运行时插值探针结果，动态物体使用最近的探针</li><li>Epic 的 Lumen 技术结合了实时路径追踪和探针缓存</li></ul></li></ul><h2 id="性能调试" tabindex="-1">性能调试 <a class="header-anchor" href="#性能调试" aria-label="Permalink to “性能调试”">​</a></h2><p>实时光线追踪的性能调试需要专门的工具和指标。</p><ul><li><p>关键指标：</p><ul><li>每像素采样数（SPP）：越高噪点越少但性能越差</li><li>光线遍历深度：BVH 树的访问次数，衡量加速结构质量</li><li>三角形测试数：实际求交的三角形数量，衡量剔除效率</li><li>帧时间分布：求交、着色、降噪各阶段的耗时</li></ul></li><li><p>调试工具：</p><ul><li>NVIDIA Nsight Graphics：可视化光线数量、BVH 遍历、降噪效果</li><li>Radeon GPU Profiler：分析硬件 RT Core 的利用率</li><li>自定义热力图：按像素显示采样数、方差、递归深度</li></ul></li><li><p>常见瓶颈：</p><ul><li>加速结构质量差：使用 SAH 启发式重建 BVH</li><li>递归深度过深：限制最大递归次数，使用俄罗斯轮盘赌</li><li>降噪不足：增加时间累积帧数，使用更好的空间滤波</li><li>光线过多：降低每像素采样数，使用重要性采样</li></ul></li></ul>',14)])])}const _=i(t,[["render",p]]);export{s as __pageData,_ as default};
