import{_ as n,o as i,c as a,j as s,a as e,ah as l}from"./chunks/framework.BwbIerCg.js";const v=JSON.parse('{"title":"DeepSpeed","description":"","frontmatter":{"title":"DeepSpeed"},"headers":[],"relativePath":"ai/compute/engine/deepspeed.md","filePath":"ai/compute/engine/deepspeed.md"}'),o={name:"ai/compute/engine/deepspeed.md"},p={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},r={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.618ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2041 1000","aria-hidden":"true"},d={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.618ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2041 1000","aria-hidden":"true"},T={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.891ex",height:"1.507ex",role:"img",focusable:"false",viewBox:"0 -666 1278 666","aria-hidden":"true"},m={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.357ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 600 453","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.62ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1600 1000","aria-hidden":"true"},x={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.62ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1600 1000","aria-hidden":"true"};function w(y,t,c,f,_,F){return i(),a("div",null,[t[21]||(t[21]=s("h1",{id:"deepspeed",tabindex:"-1"},[e("DeepSpeed "),s("a",{class:"header-anchor",href:"#deepspeed","aria-label":"Permalink to “DeepSpeed”"},"​")],-1)),t[22]||(t[22]=s("p",null,"DeepSpeed 是微软开发的分布式训练优化库，通过 ZeRO（Zero Redundancy Optimizer）技术突破显存瓶颈，使得在有限 GPU 资源上训练大模型成为可能。其核心思想是将优化器状态、梯度和参数分片（sharding）到不同设备，消除数据并行中的冗余存储。",-1)),t[23]||(t[23]=s("h2",{id:"zero-优化",tabindex:"-1"},[e("ZeRO 优化 "),s("a",{class:"header-anchor",href:"#zero-优化","aria-label":"Permalink to “ZeRO 优化”"},"​")],-1)),s("p",null,[t[4]||(t[4]=e("ZeRO 按优化激进程度分为三个阶段，逐步将显存占用从 ",-1)),s("mjx-container",p,[(i(),a("svg",r,[...t[0]||(t[0]=[l("",1)])])),t[1]||(t[1]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"O"),s("mo",{stretchy:"false"},"("),s("mn",null,"2"),s("mo",{stretchy:"false"},")")])],-1))]),t[5]||(t[5]=e(" 降至 ",-1)),s("mjx-container",d,[(i(),a("svg",h,[...t[2]||(t[2]=[l("",1)])])),t[3]||(t[3]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"O"),s("mo",{stretchy:"false"},"("),s("mn",null,"1"),s("mo",{stretchy:"false"},")")])],-1))]),t[6]||(t[6]=e("。",-1))]),s("p",null,[t[13]||(t[13]=e("ZeRO-1 仅分片优化器状态。Adam 优化器需要为每个参数存储一阶矩和二阶矩，占用 ",-1)),s("mjx-container",T,[(i(),a("svg",k,[...t[7]||(t[7]=[l("",1)])])),t[8]||(t[8]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mn",null,"2"),s("mo",null,"×")])],-1))]),t[14]||(t[14]=e(" 参数量显存。对于 7B 模型，优化器状态需要约 28GB（FP16 参数权重 14GB + FP32 一阶矩 28GB + FP32 二阶矩 28GB）。ZeRO-1 将这些状态按 GPU 数量 ",-1)),s("mjx-container",m,[(i(),a("svg",Q,[...t[9]||(t[9]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D45B",d:"M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)])])),t[10]||(t[10]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"n")])],-1))]),t[15]||(t[15]=e(" 切分，每张卡仅需存储 ",-1)),s("mjx-container",g,[(i(),a("svg",u,[...t[11]||(t[11]=[l("",1)])])),t[12]||(t[12]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mn",null,"1"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"/")]),s("mi",null,"n")])],-1))]),t[16]||(t[16]=e(" 的优化器状态，将显存从 70GB 降至约 42GB。",-1))]),t[24]||(t[24]=s("p",null,"ZeRO-2 进一步分片梯度。在反向传播完成后，每个 GPU 产生的梯度原本需要完整存储，用于更新参数。ZeRO-2 将梯度按切分方式分散存储，更新时通过 ReduceScatter 聚合分片梯度到对应 GPU，完成本地参数更新后，再通过 AllGather 同步最新参数。这又将显存降低约 25%。",-1)),s("p",null,[t[19]||(t[19]=e("ZeRO-3 是最激进的优化，连模型参数本身都进行分片。每张卡仅持有 ",-1)),s("mjx-container",x,[(i(),a("svg",E,[...t[17]||(t[17]=[l("",1)])])),t[18]||(t[18]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mn",null,"1"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"/")]),s("mi",null,"n")])],-1))]),t[20]||(t[20]=e(" 的参数，前向传播时通过 AllGather 动态获取所需层的参数，用完即释放。这带来两个挑战：一是通信量增加（每层都需要 AllGather），二是实现复杂度高（需要精确控制参数获取和释放时机）。但收益巨大：7B 模型在 8 张 A100（40GB）上，ZeRO-3 可将每卡显存占用降至约 18GB。",-1))]),t[25]||(t[25]=l("",5))])}const C=n(o,[["render",w]]);export{v as __pageData,C as default};
